# API 测试文档

本文档提供完整的 API 测试示例，可以直接使用 curl 命令测试。

## 前置条件

1. 确保 MySQL 数据库已启动并初始化
2. 确保 biometric-algo 服务已启动（端口 8081）
3. 确保 biometric-serv 服务已启动（端口 8080）

## 1. 用户管理 API 测试

### 1.1 创建用户

```bash
curl -X POST http://localhost:8080/api/user \
  -H "Content-Type: application/json" \
  -d '{
    "username": "zhangsan",
    "realName": "张三",
    "idCard": "110101199001011234",
    "mobile": "13800138000",
    "email": "zhangsan@example.com"
  }'
```

预期返回：
```json
{
  "code": 200,
  "message": "用户创建成功",
  "data": {
    "id": 1,
    "username": "zhangsan",
    "realName": "张三",
    "idCard": "110101199001011234",
    "mobile": "13800138000",
    "email": "zhangsan@example.com",
    "status": 1,
    "createTime": "2024-01-01T10:00:00",
    "updateTime": "2024-01-01T10:00:00"
  }
}
```

### 1.2 查询用户列表

```bash
curl -X GET "http://localhost:8080/api/user/list?pageNum=1&pageSize=10"
```

### 1.3 查询用户详情

```bash
curl -X GET http://localhost:8080/api/user/1
```

### 1.4 更新用户

```bash
curl -X PUT http://localhost:8080/api/user/1 \
  -H "Content-Type: application/json" \
  -d '{
    "username": "zhangsan",
    "realName": "张三三",
    "mobile": "13800138001"
  }'
```

### 1.5 删除用户

```bash
curl -X DELETE http://localhost:8080/api/user/1
```

## 2. 人脸识别 API 测试

### 2.1 注册人脸

**注意**：这里的 featureVector 是示例数据（128维），实际使用时需要通过人脸检测和特征提取算法获取。

```bash
curl -X POST http://localhost:8080/api/biometric/face/register \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "featureVector": [0.123, 0.456, 0.789, 0.234, 0.567, 0.890, 0.345, 0.678, 0.901, 0.111, 0.222, 0.333, 0.444, 0.555, 0.666, 0.777, 0.888, 0.999, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890],
    "imageUrl": "http://example.com/faces/zhangsan_001.jpg",
    "remark": "正面照"
  }'
```

预期返回：
```json
{
  "code": 200,
  "message": "人脸注册成功",
  "data": {
    "faceId": "550e8400-e29b-41d4-a716-446655440000",
    "recordId": 1,
    "costTime": 125
  }
}
```

### 2.2 1:N 人脸识别（在所有人脸库中搜索）

```bash
curl -X POST http://localhost:8080/api/biometric/face/recognize \
  -H "Content-Type: application/json" \
  -d '{
    "featureVector": [0.123, 0.456, 0.789, 0.234, 0.567, 0.890, 0.345, 0.678, 0.901, 0.111, 0.222, 0.333, 0.444, 0.555, 0.666, 0.777, 0.888, 0.999, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890],
    "queryImageUrl": "http://example.com/query/test_001.jpg"
  }'
```

预期返回：
```json
{
  "code": 200,
  "message": "识别完成",
  "data": {
    "results": [
      {
        "faceId": "550e8400-e29b-41d4-a716-446655440000",
        "userId": 1,
        "similarity": 0.95,
        "imageUrl": "http://example.com/faces/zhangsan_001.jpg",
        "matched": true
      }
    ],
    "count": 1,
    "costTime": 85
  }
}
```

### 2.3 1:1 人脸验证（验证指定用户）

```bash
curl -X POST http://localhost:8080/api/biometric/face/verify \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "featureVector": [0.123, 0.456, 0.789, 0.234, 0.567, 0.890, 0.345, 0.678, 0.901, 0.111, 0.222, 0.333, 0.444, 0.555, 0.666, 0.777, 0.888, 0.999, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890, 0.901, 0.012, 0.123, 0.234, 0.345, 0.456, 0.567, 0.678, 0.789, 0.890],
    "queryImageUrl": "http://example.com/query/test_002.jpg"
  }'
```

预期返回：
```json
{
  "code": 200,
  "message": "验证完成",
  "data": {
    "result": {
      "faceId": "550e8400-e29b-41d4-a716-446655440000",
      "userId": 1,
      "similarity": 0.92,
      "imageUrl": "http://example.com/faces/zhangsan_001.jpg",
      "matched": true
    },
    "costTime": 65
  }
}
```

### 2.4 查询用户的人脸列表

```bash
curl -X GET http://localhost:8080/api/biometric/face/user/1
```

预期返回：
```json
{
  "code": 200,
  "message": "success",
  "data": [
    {
      "id": 1,
      "faceId": "550e8400-e29b-41d4-a716-446655440000",
      "userId": 1,
      "imageUrl": "http://example.com/faces/zhangsan_001.jpg",
      "featureVector": "[0.123,0.456,...]",
      "status": 1,
      "remark": "正面照",
      "createTime": "2024-01-01T10:00:00",
      "updateTime": "2024-01-01T10:00:00"
    }
  ]
}
```

### 2.5 删除人脸

```bash
curl -X DELETE http://localhost:8080/api/biometric/face/550e8400-e29b-41d4-a716-446655440000
```

### 2.6 删除用户的所有人脸

```bash
curl -X DELETE http://localhost:8080/api/biometric/face/user/1
```

### 2.7 查询识别日志

```bash
# 查询所有日志
curl -X GET "http://localhost:8080/api/biometric/log/list?pageNum=1&pageSize=10"

# 查询指定用户的日志
curl -X GET "http://localhost:8080/api/biometric/log/list?pageNum=1&pageSize=10&userId=1"

# 查询指定类型的日志（1-1:N识别，2-1:1验证）
curl -X GET "http://localhost:8080/api/biometric/log/list?pageNum=1&pageSize=10&recognitionType=1"
```

## 3. 算法服务直接测试（可选）

如果需要直接测试算法服务，可以使用以下命令：

### 3.1 添加人脸特征

```bash
curl -X POST http://localhost:8081/api/algo/face/feature \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "featureVector": [0.123, 0.456, 0.789, ...],
    "imageUrl": "http://example.com/face.jpg"
  }'
```

### 3.2 查询特征总数

```bash
curl -X GET http://localhost:8081/api/algo/face/feature/count
```

### 3.3 1:N 识别

```bash
curl -X POST http://localhost:8081/api/algo/face/recognize \
  -H "Content-Type: application/json" \
  -d '{
    "featureVector": [0.123, 0.456, 0.789, ...]
  }'
```

## 4. 完整测试流程

```bash
# 1. 创建用户
curl -X POST http://localhost:8080/api/user \
  -H "Content-Type: application/json" \
  -d '{"username":"test001","realName":"测试用户","mobile":"13800138000"}'

# 2. 注册人脸（假设用户ID为1）
curl -X POST http://localhost:8080/api/biometric/face/register \
  -H "Content-Type: application/json" \
  -d '{
    "userId": 1,
    "featureVector": [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7],
    "imageUrl": "http://example.com/test.jpg"
  }'

# 3. 人脸识别
curl -X POST http://localhost:8080/api/biometric/face/recognize \
  -H "Content-Type: application/json" \
  -d '{
    "featureVector": [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7]
  }'

# 4. 查询识别日志
curl -X GET "http://localhost:8080/api/biometric/log/list?pageNum=1&pageSize=10"
```

## 注意事项

1. **人脸特征向量**：示例中的特征向量是模拟数据，实际应用中需要使用专业的人脸识别库（如 face_recognition、dlib、OpenCV 等）提取真实的人脸特征。

2. **特征向量维度**：常见的人脸特征向量维度有 128 维、512 维等，本示例使用 128 维。

3. **匹配阈值**：默认匹配阈值为 0.6，可以根据实际情况在配置文件中调整。

4. **性能测试**：对于大规模人脸库，建议进行压力测试以评估系统性能。

